# Astro Simple Rosey 

https://rosey.app/docs/

If you are already using i18n, see this [guide](https://cloudcannon.com/documentation/guides/rosey-migration-guide/migrating-to-rosey/) for help migrating from using i18n to Rosey.

This is a demo for how to use Rosey as a replacement for i18n. It is intended to work much the same as i18n. Rosey reads from a JSON file of translations keys for each locale, with an original phrase and a translation. You are responsible for the creation of these locale JSON files, which Rosey uses these to create a multilingual site. 

A basic example of generating these locales files without having to write them by hand has been provided in this repository by running the function in `src/assets/js/generateLocales.mjs` in our postbuild. This can be removed if you would rather write these files manually.

An example can be found [here](https://github.com/CloudCannon/rcc) of an even more automated workflow, where translatable data files are generated for translators on each build so that editors can enter translations in CloudCannon, which are then generated into the locales files mentioned above. This 'intermediate' translatable data file in the more complete workflow allows for more flexibility for what we present to editors, rather than being locked in to a format that Rosey is expecting - (like with this template).

## Getting Started

To start using this template, go to the [GitHub repository](https://github.com/CloudCannon/astro-starter/), and click `Use this template` to make your own copy.

Create two sites on CloudCannon from the same repo with a staging -> production publishing workflow.

### With no generation
1. Tag your html content for translation
2. Run `npx rosey generate --source dist` manually on your local dev env.
3. Create locales files manually from the base.json values generated from the command above.
4. Add translations to those locales files following [this format](https://rosey.app/docs/#creating-locale-files).
5. Add this to your postbuild:
    ```bash
    if [[ $TRANSLATE == "true" ]];
    then
      echo "Installing Rosey"
      npm install

      echo "Translating site with Rosey"
      # There's a little bit of shuffling around here to ensure the translated site ends up where CloudCannon picks up your site
      mv ./dist ./_untranslated_site
      npx rosey@latest build --source _untranslated_site --dest dist
    fi
    ```
6. Save and push to your production branch where the `npx rosey@latest build --source _untranslated_site --dest dist` command should run in your postbuild. Ensure the `TRANSLATE` env variable is set on your production site.

**With locale file generation**:
1. Tag your html content for translation
2. Run `npx rosey generate --source dist` (where dist is the output build dir). Since we don't have to write locales files manually, we can run this in our CloudCannon postbuild to avoid us having to manually run it.
3. Add this to your site's postbuild:

    ```bash
    npx rosey generate --source dist
    node src/assets/js/generateLocales.mjs

    if [[ $TRANSLATE == "true" ]];
    then
      echo "Installing Rosey"
      npm install

      echo "Translating site with Rosey"
      # There's a little bit of shuffling around here to ensure the translated site ends up where CloudCannon picks up your site
      mv ./dist ./_untranslated_site
      npx rosey@latest build --source _untranslated_site --dest dist
    fi
    ```
4. Editors add translations to those locales files via the CloudCannon app
5. Save and push to your production branch where the `npx rosey@latest build --source _untranslated_site --dest dist` command should run in your postbuild. Add the env variable `SYNC_PATHS=rosey/locales` to your staging site, so that the files generated by the function `node src/assets/js/generateLocales.mjs` on CloudCannon are saved back to the GitHub repository after each build.

### Commands

All commands are run from the root of the project, from a terminal:

| Command                   | Action                                           |
| :------------------------ | :----------------------------------------------- |
| `npm install`             | Installs dependencies                            |
| `npm run dev`             | Starts local dev server at `localhost:4321`      |
| `npm run build`           | Build your production site to `./dist/`          |
| `npm run astro ...`       | Run CLI commands like `astro add`, `astro check` |
| `npm run astro -- --help` | Get help using the Astro CLI                     |

### Local Development

1. Clone the repository
2. Run `npm install`
3. Run `npm start`